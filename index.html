<!DOCTYPE html>
<html>
<head>
    <title>Hardware Inventory Lookup</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .search-box {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        input[type="text"] {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .results {
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .summary-boxes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .summary-box {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            text-align: center;
        }
        .summary-box h3 {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        .summary-box .number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            margin-top: 10px;
        }
        .error {
            color: #dc3545;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hardware Inventory Lookup</h1>
        
        <div class="search-box">
            <input type="text" id="skuInput" placeholder="Enter SKU..." onkeypress="if(event.key === 'Enter') searchSKU()">
            <button onclick="searchSKU()">Search</button>
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="results" class="results" style="display: none;">
            <div class="summary-boxes">
                <div class="summary-box">
                    <h3>Total On Hand</h3>
                    <div class="number" id="totalQuantity">0</div>
                </div>
                <div class="summary-box">
                    <h3>Available to Reserve</h3>
                    <div class="number" id="totalAvailable">0</div>
                </div>
                <div class="summary-box">
                    <h3>Reserved</h3>
                    <div class="number" id="totalReserved">0</div>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Facility</th>
                        <th>Subinventory</th>
                        <th>Quantity</th>
                        <th>Available</th>
                        <th>Reserved</th>
                    </tr>
                </thead>
                <tbody id="inventoryTable">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function searchSKU() {
            const sku = document.getElementById('skuInput').value;
            if (!sku) return;

            // Clear previous results
            document.getElementById('error').style.display = 'none';
            document.getElementById('results').style.display = 'none';

            // Execute Snowflake query (this is just a placeholder)
            // In reality, you'll use Goose's Snowflake extension
            const query = `
                WITH latest_snapshot AS (
                    SELECT MAX(snapshot_date) as max_date
                    FROM oracle_erp.scm.sq_cloud_item_onhand_detail
                )
                SELECT 
                    organization_code as facility,
                    subinventory_code,
                    total_onhand as quantity,
                    available_to_reserve_qty as available_to_reserve,
                    reservation_qty as reserved,
                    description
                FROM oracle_erp.scm.sq_cloud_item_onhand_detail
                WHERE item_number = '${sku}'
                AND snapshot_date = (SELECT max_date FROM latest_snapshot)
                ORDER BY 
                    CASE subinventory_code 
                        WHEN 'P000' THEN 1
                        WHEN 'AVLBL' THEN 2
                        WHEN 'SALES' THEN 3
                        WHEN 'RETAIL' THEN 4
                        WHEN 'SHOP' THEN 5
                        WHEN 'WARRANTY' THEN 6
                        WHEN 'RETURN' THEN 7
                        WHEN 'RETURN-HLD' THEN 8
                        WHEN 'UN-AVLBL' THEN 9
                        ELSE 10
                    END,
                    organization_code
            `;

            // Display the query for copying
            console.log('Query to run in Goose:');
            console.log(query);

            // Show instructions
            document.getElementById('error').textContent = 'Please copy and run this query in Goose. The query has been logged to the console.';
            document.getElementById('error').style.display = 'block';
        }

        function displayResults(data) {
            const results = document.getElementById('results');
            const table = document.getElementById('inventoryTable');
            const error = document.getElementById('error');

            if (!data || !data.results || data.results.length === 0) {
                error.textContent = 'No inventory found for this SKU';
                error.style.display = 'block';
                results.style.display = 'none';
                return;
            }

            // Calculate totals
            let totalQuantity = 0;
            let totalAvailable = 0;
            let totalReserved = 0;

            // Clear previous results
            table.innerHTML = '';

            // Add rows to table
            data.results.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.FACILITY}</td>
                    <td>${row.SUBINVENTORY_CODE}</td>
                    <td>${row.QUANTITY || 0}</td>
                    <td>${row.AVAILABLE_TO_RESERVE || 0}</td>
                    <td>${row.RESERVED || 0}</td>
                `;
                table.appendChild(tr);

                // Update totals
                totalQuantity += row.QUANTITY || 0;
                totalAvailable += row.AVAILABLE_TO_RESERVE || 0;
                totalReserved += row.RESERVED || 0;
            });

            // Update summary boxes
            document.getElementById('totalQuantity').textContent = totalQuantity;
            document.getElementById('totalAvailable').textContent = totalAvailable;
            document.getElementById('totalReserved').textContent = totalReserved;

            // Show results
            error.style.display = 'none';
            results.style.display = 'block';
        }
    </script>
</body>
</html>
